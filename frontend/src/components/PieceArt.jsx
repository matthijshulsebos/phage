import { useState } from 'react';

// Fallback pixel art definitions
const pixelArtData = {
  virus: {
    pixels: [
      [0,0,0,0,1,1,1,1,0,0,0,0],
      [0,0,0,1,2,2,2,2,1,0,0,0],
      [0,0,1,2,2,3,3,2,2,1,0,0],
      [0,1,2,2,3,3,3,3,2,2,1,0],
      [1,2,2,3,3,3,3,3,3,2,2,1],
      [1,2,2,3,3,3,3,3,3,2,2,1],
      [1,2,2,3,3,3,3,3,3,2,2,1],
      [1,2,2,3,3,3,3,3,3,2,2,1],
      [0,1,2,2,3,3,3,3,2,2,1,0],
      [0,0,1,2,2,3,3,2,2,1,0,0],
      [0,0,0,1,2,2,2,2,1,0,0,0],
      [0,0,0,0,1,1,1,1,0,0,0,0],
    ],
    colors: { 1: '#1f1f1f', 2: '#7c3aed', 3: '#a855f7' }
  },
  bacteria: {
    pixels: [
      [0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,1,1,1,1,1,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,1,0,0],
      [0,1,2,2,3,3,3,3,2,2,1,0],
      [0,1,2,3,3,4,4,3,3,2,1,0],
      [0,1,2,3,4,4,4,4,3,2,1,0],
      [0,1,2,3,4,4,4,4,3,2,1,0],
      [0,1,2,3,3,4,4,3,3,2,1,0],
      [0,1,2,2,3,3,3,3,2,2,1,0],
      [0,0,1,2,2,2,2,2,2,1,0,0],
      [0,0,0,1,1,1,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0],
    ],
    colors: { 1: '#1f1f1f', 2: '#ec4899', 3: '#f472b6', 4: '#fce7f3' }
  },
  t_cell: {
    pixels: [
      [0,0,0,0,1,1,1,1,0,0,0,0],
      [0,0,1,1,2,2,2,2,1,1,0,0],
      [0,1,2,2,2,3,3,2,2,2,1,0],
      [0,1,2,2,3,4,4,3,2,2,1,0],
      [1,2,2,3,4,4,4,4,3,2,2,1],
      [1,2,3,4,4,5,5,4,4,3,2,1],
      [1,2,3,4,4,5,5,4,4,3,2,1],
      [1,2,2,3,4,4,4,4,3,2,2,1],
      [0,1,2,2,3,4,4,3,2,2,1,0],
      [0,1,2,2,2,3,3,2,2,2,1,0],
      [0,0,1,1,2,2,2,2,1,1,0,0],
      [0,0,0,0,1,1,1,1,0,0,0,0],
    ],
    colors: { 1: '#1f1f1f', 2: '#0d9488', 3: '#14b8a6', 4: '#5eead4', 5: '#99f6e4' }
  },
  dendritic_cell: {
    pixels: [
      [0,0,0,0,0,1,1,0,0,0,0,0],
      [0,0,0,0,1,2,2,1,0,0,0,0],
      [0,0,0,0,1,2,2,1,0,0,0,0],
      [0,1,1,1,2,3,3,2,1,1,1,0],
      [1,2,2,2,3,3,3,3,2,2,2,1],
      [1,2,3,3,3,4,4,3,3,3,2,1],
      [1,2,3,3,3,4,4,3,3,3,2,1],
      [1,2,2,2,3,3,3,3,2,2,2,1],
      [0,1,1,1,2,3,3,2,1,1,1,0],
      [0,0,0,0,1,2,2,1,0,0,0,0],
      [0,0,0,0,1,2,2,1,0,0,0,0],
      [0,0,0,0,0,1,1,0,0,0,0,0],
    ],
    colors: { 1: '#1f1f1f', 2: '#2563eb', 3: '#3b82f6', 4: '#93c5fd' }
  },
  red_blood_cell: {
    pixels: [
      [0,0,0,0,1,1,1,1,0,0,0,0],
      [0,0,1,1,2,2,2,2,1,1,0,0],
      [0,1,2,2,2,2,2,2,2,2,1,0],
      [0,1,2,2,3,3,3,3,2,2,1,0],
      [1,2,2,3,3,4,4,3,3,2,2,1],
      [1,2,2,3,4,4,4,4,3,2,2,1],
      [1,2,2,3,4,4,4,4,3,2,2,1],
      [1,2,2,3,3,4,4,3,3,2,2,1],
      [0,1,2,2,3,3,3,3,2,2,1,0],
      [0,1,2,2,2,2,2,2,2,2,1,0],
      [0,0,1,1,2,2,2,2,1,1,0,0],
      [0,0,0,0,1,1,1,1,0,0,0,0],
    ],
    colors: { 1: '#1f1f1f', 2: '#dc2626', 3: '#ef4444', 4: '#fca5a5' }
  },
  debris: {
    pixels: [
      [0,0,0,0,1,0,0,0,0,1,0,0],
      [0,0,0,1,2,1,0,0,1,2,1,0],
      [0,0,1,2,2,1,0,1,2,2,1,0],
      [0,1,2,2,1,0,0,1,2,2,1,0],
      [0,1,2,1,0,0,0,0,1,2,1,0],
      [0,0,1,0,0,1,1,0,0,1,0,0],
      [0,0,0,0,1,2,2,1,0,0,0,0],
      [0,1,0,1,2,2,2,1,0,1,0,0],
      [1,2,1,1,2,2,1,0,1,2,1,0],
      [1,2,2,1,1,1,0,0,1,2,1,0],
      [0,1,2,1,0,0,0,0,0,1,0,0],
      [0,0,1,0,0,0,0,0,0,0,0,0],
    ],
    colors: { 1: '#374151', 2: '#6b7280' }
  }
};

function PixelArtFallback({ type, size }) {
  const piece = pixelArtData[type];
  if (!piece) {
    return <span style={{ fontSize: size * 0.6 }}>?</span>;
  }

  const { pixels, colors } = piece;

  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 12 12"
      style={{ imageRendering: 'pixelated' }}
    >
      {pixels.map((row, y) =>
        row.map((pixel, x) =>
          pixel !== 0 && (
            <rect
              key={`${x}-${y}`}
              x={x}
              y={y}
              width={1}
              height={1}
              fill={colors[pixel]}
            />
          )
        )
      )}
    </svg>
  );
}

function PieceArt({ type, size = 48 }) {
  const [imageError, setImageError] = useState(false);

  // Map piece types to image files in /public/images/
  const imageMap = {
    virus: '/images/virus.png',
    bacteria: '/images/bacteria.png',
    t_cell: '/images/t_cell.png',
    dendritic_cell: '/images/dendritic_cell.png',
    red_blood_cell: '/images/red_blood_cell.png',
    debris: '/images/debris.png',
  };

  const imageSrc = imageMap[type];

  // If no image mapping or image failed to load, use pixel art fallback
  if (!imageSrc || imageError) {
    return <PixelArtFallback type={type} size={size} />;
  }

  return (
    <img
      src={imageSrc}
      alt={type.replace('_', ' ')}
      width={size}
      height={size}
      style={{ imageRendering: 'pixelated' }}
      onError={() => setImageError(true)}
    />
  );
}

export default PieceArt;
